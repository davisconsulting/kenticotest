@using DancingGoat.Models.InlineEditors
@using DancingGoat.Models.Widgets
@using DancingGoat.Models.InlineEditors.MegaMenuEditor;
@using DancingGoat.Models.InlineEditors.PageTypeSelector;
@using DancingGoat.Models.InlineEditors.SiteSelector;

@model  DancingGoat.Models.Widgets.MegaMenu.MegaMenuWidgetPropertiesViewModel

<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<style>
    .dropdown-submenu {
        position: relative;
    }

        .dropdown-submenu > .dropdown-menu {
            top: 0;
            left: 100%;
            margin-top: -6px;
            margin-left: -1px;
            -webkit-border-radius: 0 6px 6px 6px;
            -moz-border-radius: 0 6px 6px;
            border-radius: 0 6px 6px 6px;
        }

        .dropdown-submenu:hover > .dropdown-menu {
            display: block;
        }

        .dropdown-submenu > a:after {
            display: block;
            content: " ";
            float: right;
            width: 0;
            height: 0;
            border-color: transparent;
            border-style: solid;
            border-width: 5px 0 5px 5px;
            border-left-color: #ccc;
            margin-top: 5px;
            margin-right: -10px;
        }

        .dropdown-submenu:hover > a:after {
            border-left-color: #fff;
        }

        .dropdown-submenu.pull-left {
            float: none;
        }

            .dropdown-submenu.pull-left > .dropdown-menu {
                left: -100%;
                margin-left: 10px;
                -webkit-border-radius: 6px 0 6px 6px;
                -moz-border-radius: 6px 0 6px 6px;
                border-radius: 6px 0 6px 6px;
            }
</style>

@if (Model.Visible == true)
{
    @Html.Raw(Model.ContentBefore)
}

@if (Context.Kentico().PageBuilder().EditMode)
{
    <div class="row">

        <div class="col-md-6">
            @{Html.RenderPartial("InlineEditors/_PageTypeSelector", new PageTypeSelectorModel
                {
                    PropertyName = nameof(MegaMenuEditorViewModel.PageType),
                    Types = Model.AvailableTypes,
                    Value = Model.PageType
                });
            }
        </div>
        <div class="col-md-6">
            @{Html.RenderPartial("InlineEditors/_SiteSelector", new SiteSelectorModel
                {
                    PropertyName = nameof(MegaMenuEditorViewModel.Site),
                    Types = Model.AvailableSite,
                    Value = Model.Site
                });
            }
        </div>

    </div>
    if (Model.Menus.Count > 0)
    {
        <div class="navbar">
            @foreach (var parentMenu in Model.Menus)
            {
                if (parentMenu.ParentNodeID == 0)
                {
                    <a href="@parentMenu.RedirectionURL">@parentMenu.NodeDisplayName</a>
                }
                if (parentMenu.NodeHasChild)
                {
                    <div class="dropdown">
                        <button class="dropbtn">
                            @parentMenu.NodeDisplayName
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-content">
                            <div class="row">
                                <div class="column">
                                    @foreach (var childMenu in Model.Menus.Where(x => x.ParentNodeID == parentMenu.NodeID))
                                    {
                                        <a href="@childMenu.RedirectionURL">@childMenu.NodeDisplayName</a>

                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    }
}
else
{
    if (Model.Visible == true)
    {
        if (Model.Menus.Count > 0)
        {
            <div class="row" style="display:flex;">
                @foreach (var menu in Model.Menus)
                {
                    <div class="dropdown">
                        @if (menu.ChildMenu == null || menu.ChildMenu.Count == 0)
                        {
                        <a id="dLabel" href="#" class="btn btn-primary">
                            @menu.NodeDisplayName
                        </a>
                        }
                        else
                        {
                        <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="sub-menu-@menu.NodeID" href="#">
                            @menu.NodeDisplayName <span class="caret"></span>
                        </a>
                        <ul id="sub-menu-@menu.NodeID" class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
                            @foreach (var item in menu.ChildMenu)
                            {
                                Html.RenderPartial("Widgets/_ChildMenu", item);
                            }
                        </ul>
                        }
                    </div>
                }
            </div>
        }
    }
}
@if (Model.Visible == true)
{
    @Html.Raw(Model.ContetAfter)
}

@*<div class="dropdown">
        <a id="dLabel" role="button" data-toggle="dropdown" class="btn btn-primary" data-target="#" href="/page.html">
            Dropdown <span class="caret"></span>
        </a>
        <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="#">Some action</a></li>
            <li><a href="#">Some other action</a></li>
            <li class="divider"></li>
            <li class="dropdown-submenu">
                <a tabindex="-1" href="#">Hover me for more options</a>
                <ul class="dropdown-menu">
                    <li><a tabindex="-1" href="#">Second level</a></li>
                    <li class="dropdown-submenu">
                        <a href="#">Even More..</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">3rd level</a></li>
                            <li><a href="#">3rd level</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Second level</a></li>
                    <li><a href="#">Second level</a></li>
                </ul>
            </li>
        </ul>
    </div>*@